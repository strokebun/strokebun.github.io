<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="1. RedisRedis，Remote Dictonary Server，远程字典服务，是一个高性能键值数据库，在后端开发中广泛使用。 Redis 的数据存储在内存中，其网络 IO 处理和数据处理采用一个线程实现，也称 Redis 是单线程的。  严格上来说 Redis 不是单线程的，持久化、异步删除等操作是由额外的线程执行的。由于单个主线程处理网络请求跟不上底层硬件的速度，在 Redis 6.">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis核心原理与实战(1) 介绍">
<meta property="og:url" content="https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/index.html">
<meta property="og:site_name" content="面向money编程">
<meta property="og:description" content="1. RedisRedis，Remote Dictonary Server，远程字典服务，是一个高性能键值数据库，在后端开发中广泛使用。 Redis 的数据存储在内存中，其网络 IO 处理和数据处理采用一个线程实现，也称 Redis 是单线程的。  严格上来说 Redis 不是单线程的，持久化、异步删除等操作是由额外的线程执行的。由于单个主线程处理网络请求跟不上底层硬件的速度，在 Redis 6.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/数据类型.png">
<meta property="og:image" content="https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/淘汰策略.png">
<meta property="article:published_time" content="2022-02-06T01:30:52.000Z">
<meta property="article:modified_time" content="2022-02-06T04:31:16.490Z">
<meta property="article:author" content="StrokeBun">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/数据类型.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Redis核心原理与实战(1) 介绍</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(2)%20%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2022/02/05/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B(5)%20%E7%BA%BF%E7%A8%8B%E6%B1%A0/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&text=Redis核心原理与实战(1) 介绍"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&title=Redis核心原理与实战(1) 介绍"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&is_video=false&description=Redis核心原理与实战(1) 介绍"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Redis核心原理与实战(1) 介绍&body=Check out this article: https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&title=Redis核心原理与实战(1) 介绍"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&title=Redis核心原理与实战(1) 介绍"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&title=Redis核心原理与实战(1) 介绍"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&title=Redis核心原理与实战(1) 介绍"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&name=Redis核心原理与实战(1) 介绍&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&t=Redis核心原理与实战(1) 介绍"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Redis"><span class="toc-number">1.</span> <span class="toc-text">1. Redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">2. 数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 基本类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-String"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 String</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-List"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 List</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-Set"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.1.3 Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-Hash"><span class="toc-number">2.1.4.</span> <span class="toc-text">2.1.4 Hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-Zset"><span class="toc-number">2.1.5.</span> <span class="toc-text">2.1.5 Zset</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 特殊数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-geospatial-%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 geospatial 地理位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-Hyperloglog"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2 Hyperloglog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-Bitmaps"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.3 Bitmaps</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">3.</span> <span class="toc-text">3. 持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-RDB"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 RDB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E8%A7%A6%E5%8F%91%E6%97%B6%E6%9C%BA"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 触发时机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.1.3 创建指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-AOF"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 AOF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%86%99%E5%9B%9E%E7%AD%96%E7%95%A5"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 写回策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-AOF%E9%87%8D%E5%86%99"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3 AOF重写</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5"><span class="toc-number">4.</span> <span class="toc-text">4. 淘汰策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">5.</span> <span class="toc-text">参考资料</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Redis核心原理与实战(1) 介绍
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">StrokeBun</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-02-06T01:30:52.000Z" itemprop="datePublished">2022-02-06</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Redis/" rel="tag">Redis</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="1-Redis"><a href="#1-Redis" class="headerlink" title="1. Redis"></a>1. Redis</h2><p>Redis，Remote Dictonary Server，远程字典服务，是一个高性能键值数据库，在后端开发中广泛使用。</p>
<p>Redis 的数据存储在内存中，其网络 IO 处理和数据处理采用一个线程实现，也称 Redis 是单线程的。</p>
<blockquote>
<p>严格上来说 Redis 不是单线程的，持久化、异步删除等操作是由额外的线程执行的。由于单个主线程处理网络请求跟不上底层硬件的速度，在 Redis 6.0 后，网络 IO 处理改为多线程，数据访问仍为单线程。</p>
</blockquote>
<h2 id="2-数据类型"><a href="#2-数据类型" class="headerlink" title="2. 数据类型"></a>2. 数据类型</h2><h3 id="2-1-基本类型"><a href="#2-1-基本类型" class="headerlink" title="2.1 基本类型"></a>2.1 基本类型</h3><p>Redis 的五大基本数据类型包括：String、List、Set、Hash、Zset。</p>
<h4 id="2-1-1-String"><a href="#2-1-1-String" class="headerlink" title="2.1.1 String"></a>2.1.1 String</h4><p>String 即字符串，常见用途是存储序列化后的用户信息</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> APPEND key str ---&gt; 追加字符串，如果key不存在，则新建</span><br><span class="line"><span class="bullet">2.</span> STRLEN key ---&gt; 获取字符串长度</span><br><span class="line"><span class="bullet">3.</span> incr/decr key ---&gt; key对应的值自增/自减</span><br><span class="line"><span class="bullet">4.</span> INCRBY/DECRBY key step ---&gt; key对应的值增加/减少step</span><br><span class="line"><span class="bullet">5.</span> GETRANGE key start end ---&gt; 类似substr，截取字符串</span><br><span class="line"><span class="bullet">6.</span> SETRANGE key start end ---&gt; 替换部分字符串</span><br><span class="line"><span class="bullet">7.</span> setex key timeout value ---&gt; 设置k/v以及过期时间</span><br><span class="line"><span class="bullet">8.</span> setnx key value ---&gt; 设置k/v，如果key存在则失败</span><br><span class="line"><span class="bullet">9.</span> mset/msetnx k1 v1 k2 v2 ---&gt; 设置多个k/v，msetnx是原子操作，只能一起成功或者一起失败</span><br></pre></td></tr></table></figure>
<h4 id="2-1-2-List"><a href="#2-1-2-List" class="headerlink" title="2.1.2 List"></a>2.1.2 List</h4><p>List 即链表，常用于消息队列</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> LPUSH/RPUSH key value ---&gt; 往列表key头/尾插入数值</span><br><span class="line"><span class="bullet">2.</span> LPOP/RPOP key ----&gt; 移除列表的头/尾元素</span><br><span class="line"><span class="bullet">3.</span> LRANGE key start end ---&gt; 获取列表key一部分数据</span><br><span class="line"><span class="bullet">4.</span> LINDEX key index ---&gt; 获取第index个元素</span><br><span class="line"><span class="bullet">5.</span> LREM key count value ---&gt; 移除指定个数的value</span><br><span class="line"><span class="bullet">6.</span> LLEN key ---&gt; 获取列表的长度</span><br><span class="line"><span class="bullet">7.</span> LTRIM key start stop ---&gt; 通过下标截取指定范围的数据</span><br><span class="line"><span class="bullet">8.</span> LSET list index value ---&gt; 更新第index元素的value</span><br></pre></td></tr></table></figure>
<h4 id="2-1-3-Set"><a href="#2-1-3-Set" class="headerlink" title="2.1.3 Set"></a>2.1.3 Set</h4><p>Set 即集合，实现集合交并操作</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> sadd myset value ---&gt; 添加元素</span><br><span class="line"><span class="bullet">2.</span> SMEMBERS myset  ---&gt; 查看指定set的所有值</span><br><span class="line"><span class="bullet">3.</span> SISMEMBER myset value  ---&gt; 查看value是否在myset中</span><br><span class="line"><span class="bullet">4.</span> scard myset ---&gt; 查看元素个数</span><br><span class="line"><span class="bullet">5.</span> srem myset value ---&gt; 删除set中的value元素</span><br><span class="line"><span class="bullet">6.</span> 集合操作</span><br><span class="line"><span class="bullet">	-</span> 差集: SDIFF set1 set2 </span><br><span class="line"><span class="bullet">	-</span> 交集: SINTER set1 set2</span><br><span class="line"><span class="bullet">	-</span> 并集: SUNION set1 set2</span><br></pre></td></tr></table></figure>
<h4 id="2-1-4-Hash"><a href="#2-1-4-Hash" class="headerlink" title="2.1.4 Hash"></a>2.1.4 Hash</h4><p>Hash 即字典，类似 java 中的 HashMap</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> hset myhash key1 value1   ---&gt; 设置元素</span><br><span class="line"><span class="bullet">2.</span> hmset myhash k1 v1 k2 v2  ---&gt; 批量设置</span><br><span class="line"><span class="bullet">3.</span> hgetall myhash ---&gt; 获得key对应的map</span><br><span class="line"><span class="bullet">4.</span> hdel myhash ---&gt;删除key对象的map</span><br><span class="line"><span class="bullet">5.</span> hlen myhash ---&gt; 获取字段数量</span><br></pre></td></tr></table></figure>
<h4 id="2-1-5-Zset"><a href="#2-1-5-Zset" class="headerlink" title="2.1.5 Zset"></a>2.1.5 Zset</h4><p>Zset 为排序的集合</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> zadd myset score value  ---&gt; 添加元素，优先级为score</span><br><span class="line"><span class="bullet">2.</span> ZRANGEBYSOCRE myset min max [WITHSOCRES] ---&gt; 获取score范围在min - max 之间的元素，可选带优先级</span><br><span class="line"><span class="bullet">3.</span> zcount myset min max ---&gt; 获取指定区间的成员数量</span><br></pre></td></tr></table></figure>
<h3 id="2-2-特殊数据类型"><a href="#2-2-特殊数据类型" class="headerlink" title="2.2 特殊数据类型"></a>2.2 特殊数据类型</h3><h4 id="2-2-1-geospatial-地理位置"><a href="#2-2-1-geospatial-地理位置" class="headerlink" title="2.2.1 geospatial 地理位置"></a>2.2.1 geospatial 地理位置</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">常用命令</span><br><span class="line"><span class="bullet">1.</span> geoadd table 经度 纬度 placename ---&gt; 添加地理位置</span><br><span class="line"><span class="bullet">2.</span> getpos table placename ---&gt; 获取指定位置的经度和纬度</span><br><span class="line"><span class="bullet">3.</span> geodist table placename1 placename2 单位 ---&gt; 获取两地的直线距离</span><br><span class="line"><span class="bullet">4.</span> georadius table 经度 纬度 半径 单位 ---&gt; 以所给经度、纬度为圆心，获得在半径范围内的位置</span><br><span class="line"><span class="bullet">5.</span> georadiusbymember table place 半径 单位 ---&gt; 以所给位置为圆心，获得在半径范围内的位置</span><br></pre></td></tr></table></figure>
<h4 id="2-2-Hyperloglog"><a href="#2-2-Hyperloglog" class="headerlink" title="2.2 Hyperloglog"></a>2.2 Hyperloglog</h4><p>Redis 2.8.9 加入了 hyperloglog，用来进行基数统计，基数为一个数据集中不重复元素的个数。其优点是占用内存固定，但计算存在一定误差。适用场景为允许误差的统计，例如一个网站每天的用户访问量。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">常用命令</span><br><span class="line"><span class="bullet">1.</span> PFadd mykey v1 v2 v3 v4.... ---&gt; 添加元素</span><br><span class="line"><span class="bullet">2.</span> PFCOUNT mykey ---&gt; 计算mykey的基数</span><br><span class="line"><span class="bullet">3.</span> PFMERGE dist mykey1 mykey2... ---&gt; 合并多个hyperloglog</span><br></pre></td></tr></table></figure>
<h4 id="2-3-Bitmaps"><a href="#2-3-Bitmaps" class="headerlink" title="2.3 Bitmaps"></a>2.3 Bitmaps</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">常用命令</span><br><span class="line"><span class="bullet">1.</span> setbit mapname index value ---&gt; 将第index位设置为value，value为0/1</span><br><span class="line"><span class="bullet">2.</span> getbit mapname index ---&gt; 取得第index位</span><br><span class="line"><span class="bullet">3.</span> bitcount mapname ---&gt; 计算位图中1的个数</span><br></pre></td></tr></table></figure>
<p>各数据类型的特点和对比如下图所示。</p>
<p><img src="数据类型.png" alt="alt"></p>
<h2 id="3-持久化"><a href="#3-持久化" class="headerlink" title="3. 持久化"></a>3. 持久化</h2><p>Redis 的数据都是保存在内存的，如果宕机会丢失所有数据，Redis 为了数据恢复，引入了 RDB 和 AOF  两种机制。</p>
<h3 id="3-1-RDB"><a href="#3-1-RDB" class="headerlink" title="3.1 RDB"></a>3.1 RDB</h3><h4 id="3-1-1-介绍"><a href="#3-1-1-介绍" class="headerlink" title="3.1.1 介绍"></a>3.1.1 介绍</h4><p>RDB 是 Redis 的内存快照，只保存当前时刻的数据，在创建 RDB 文件过程中的数据修改不会记录，不具备数据完整性。</p>
<p>优缺点：</p>
<ul>
<li>优点：适合大规模的数据恢复，对数据的完整性要求不高</li>
<li>缺点：需要一定时间进程才能操作，Redis 挂了的话，最后一次修改数据的操作丢失；fork 进程的时候占用较大内存</li>
</ul>
<h4 id="3-1-2-触发时机"><a href="#3-1-2-触发时机" class="headerlink" title="3.1.2 触发时机"></a>3.1.2 触发时机</h4><ul>
<li>用户执行 SAVE、BGSAVE</li>
<li>配置的 save 规则满足</li>
<li>执行 flushall 命令</li>
<li>退出 redis</li>
</ul>
<h4 id="3-1-3-创建指令"><a href="#3-1-3-创建指令" class="headerlink" title="3.1.3 创建指令"></a>3.1.3 创建指令</h4><ul>
<li>SAVE：阻塞服务器进程，直到文件创建完毕</li>
<li>BGSAVE：默认使用，利用 copy on write 创建一个子进程进行持久化，父进程继续处理客户端请求，在此过程中拒绝 SAVE、BGSAVE 操作防止竞争</li>
</ul>
<h3 id="3-2-AOF"><a href="#3-2-AOF" class="headerlink" title="3.2 AOF"></a>3.2 AOF</h3><h4 id="3-2-1-介绍"><a href="#3-2-1-介绍" class="headerlink" title="3.2.1 介绍"></a>3.2.1 介绍</h4><p>AOF 以写后日志的形式记录每个写操作，利用 AOF 恢复数据会重新执行这些操作。</p>
<blockquote>
<p>写后日志即先执行命令后写数据，为了降低开销，Redis 向 AOF 记录日志并不会进行语法检查，所以先执行命令成功再写入日志。写后日志会丢失最新一次的修改。</p>
</blockquote>
<h4 id="3-2-2-写回策略"><a href="#3-2-2-写回策略" class="headerlink" title="3.2.2 写回策略"></a>3.2.2 写回策略</h4><p>写回策略决定了 AOF 持久化的时机，包括：</p>
<ul>
<li>Always：同步写回，每个写命令执行完立即同步日志到磁盘。基本不丢数据，但影响主线程性能。</li>
<li>Everysec：每秒写回，将日志写到 AOF 文件的内存缓冲区，每隔一秒同步到磁盘。宕机时丢失 1 秒内的数据，对性能影响折中。</li>
<li>No：操作系统控制写回，将日志写到缓冲区，由操作习题决定同步磁盘的时机。丢失数据最多，但对性能影响最小。</li>
</ul>
<h4 id="3-2-3-AOF重写"><a href="#3-2-3-AOF重写" class="headerlink" title="3.2.3 AOF重写"></a>3.2.3 AOF重写</h4><p>由于 AOF 文件只能追加，经过长时间运行，AOF 文件过大，继续追加日志以及数据恢复的耗时都会变长，故引入 AOF 重写机制。</p>
<p>重写的思想为将旧日志中的对同一个 key 的多条命令变为一条命令。</p>
<p>AOF 重写流程：</p>
<ul>
<li>创建子进程进行重写操作</li>
<li>在重写过程如果服务器收到指令，则将追加到 AOF 缓冲区和 AOF 重写缓冲区</li>
<li>子进程完成重写向父进程发送信号，父进程原子替换 AOF 文件</li>
</ul>
<h2 id="4-淘汰策略"><a href="#4-淘汰策略" class="headerlink" title="4. 淘汰策略"></a>4. 淘汰策略</h2><p>随着服务的运行，缓存被写满是不可避免的，此时需要对缓存中的数据进行淘汰，Redis 的淘汰策略包含：</p>
<ul>
<li>noeviction：默认淘汰策略，可进行删读，不可增改</li>
<li>volatile-lru：使用 LRU 淘汰设置了过期时间的 key</li>
<li>volatile-lfu：使用 LFU 淘汰设置了过期时间的 key</li>
<li>volatile-ttl：淘汰最先要过期的 key</li>
<li>volatile-random：随机淘汰会过期的 key</li>
<li>allkeys-lru：使用 LRU 淘汰 key</li>
<li>allkeys-lfu：使用 LFU 淘汰 key</li>
<li>allkets-random：随机淘汰key</li>
</ul>
<blockquote>
<p>LRU，Least Recently Used，最近最少使用算法，淘汰最近未被使用过的数据；</p>
<p>LFU，Least Frequently Used，最不经常使用算法，淘汰使用次数最少的数据。</p>
</blockquote>
<p><img src="淘汰策略.png" alt="alt"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100056701">Redis核心技术与实战</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/25900156/">Redis设计与实现</a></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Redis"><span class="toc-number">1.</span> <span class="toc-text">1. Redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">2. 数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 基本类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-String"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 String</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-List"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 List</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-Set"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.1.3 Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-Hash"><span class="toc-number">2.1.4.</span> <span class="toc-text">2.1.4 Hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-Zset"><span class="toc-number">2.1.5.</span> <span class="toc-text">2.1.5 Zset</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 特殊数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-geospatial-%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 geospatial 地理位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-Hyperloglog"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2 Hyperloglog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-Bitmaps"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.3 Bitmaps</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">3.</span> <span class="toc-text">3. 持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-RDB"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 RDB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E8%A7%A6%E5%8F%91%E6%97%B6%E6%9C%BA"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 触发时机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.1.3 创建指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-AOF"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 AOF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%86%99%E5%9B%9E%E7%AD%96%E7%95%A5"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 写回策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-AOF%E9%87%8D%E5%86%99"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3 AOF重写</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5"><span class="toc-number">4.</span> <span class="toc-text">4. 淘汰策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">5.</span> <span class="toc-text">参考资料</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&text=Redis核心原理与实战(1) 介绍"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&title=Redis核心原理与实战(1) 介绍"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&is_video=false&description=Redis核心原理与实战(1) 介绍"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Redis核心原理与实战(1) 介绍&body=Check out this article: https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&title=Redis核心原理与实战(1) 介绍"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&title=Redis核心原理与实战(1) 介绍"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&title=Redis核心原理与实战(1) 介绍"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&title=Redis核心原理与实战(1) 介绍"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&name=Redis核心原理与实战(1) 介绍&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://strokebun.github.io/2022/02/06/Redis%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98(1)%20%E4%BB%8B%E7%BB%8D/&t=Redis核心原理与实战(1) 介绍"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022
    StrokeBun
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>
</html>
